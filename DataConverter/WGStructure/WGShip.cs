// <auto-generated />

using System;
using JsonSubTypes;
using Newtonsoft.Json;
using System.Collections.Generic;
using System.Linq;
using Newtonsoft.Json.Linq;
using WoWsShipBuilderDataStructures;

namespace DataConverter.WGStructure
{
    public class WGShip
    {
        public Dictionary<string, ModuleArmaments> ModulesArmaments { get; set; }
        public Dictionary<string, ShipAbility> ShipAbilities { get; set; }
        public ShipUpgradeInfo ShipUpgradeInfo { get; set; }
        public long id { get; set; }
        public string index { get; set; }
        public int level { get; set; }
        public string name { get; set; }
        public Typeinfo typeinfo { get; set; }
    }

    [JsonConverter(typeof(JsonSubtypes))]
    [JsonSubtypes.KnownSubTypeWithProperty(typeof(MainBattery), "guns")]
    [JsonSubtypes.KnownSubTypeWithProperty(typeof(WgFireControl), "maxDistCoef")]
    [JsonSubtypes.KnownSubTypeWithProperty(typeof(WgTorpedoArray), "torpedoArray")]
    [JsonSubtypes.KnownSubTypeWithProperty(typeof(ATBA), "antiAirAndSecondaries")]
    [JsonSubtypes.KnownSubTypeWithProperty(typeof(AirSupport), "maxPlaneFlightDist")]
    [JsonSubtypes.KnownSubTypeWithProperty(typeof(AirDefense), "isAA")] 
    [JsonSubtypes.KnownSubTypeWithProperty(typeof(WgDepthChargesArray), "depthCharges")]
    [JsonSubtypes.KnownSubTypeWithProperty(typeof(WgEngine), "forwardEngineUpTime")]
    [JsonSubtypes.KnownSubTypeWithProperty(typeof(WgHull), "visibilityFactor")]
    [JsonSubtypes.KnownSubTypeWithProperty(typeof(WgFlightControl), "squadrons")]
    [JsonSubtypes.KnownSubTypeWithProperty(typeof(WgPingerGun), "waveReloadTime")]
    [JsonSubtypes.KnownSubTypeWithProperty(typeof(WgPlane), "planeType")]
    public class ModuleArmaments { }

    #region Main battery
    public class MainBattery : ModuleArmaments
    {
        public Dictionary<string, MainBatteryGun> guns { get; set; }
        public decimal maxDist { get; set; }
        public decimal sigmaCount { get; set; }
        public double taperDist { get; set; }
        
        public bool normalDistribution { get; set; }

        [JsonExtensionData]
        public Dictionary<string, JToken> AntiAirAuras { get; set; }

        [JsonIgnore]
        public Dictionary<string, AAAura> ConvertedAntiAirAuras
        {
            get => AntiAirAuras?.ToDictionary(entry => entry.Key, entry => entry.Value.ToObject<AAAura>()) ?? new Dictionary<string, AAAura>() ;
        }
    }

    public class MainBatteryGun
    {
        public string[] ammoList { get; set; }
        public decimal barrelDiameter { get; set; }
        public double[] horizSector { get; set; }
        public long id { get; set; }
        public string index { get; set; }
        public string name { get; set; }
        public int numBarrels { get; set; }
        public double[] position { get; set; }
        public decimal[] rotationSpeed { get; set; }
        public double[][] deadZone { get; set; }
        public decimal shotDelay { get; set; }
        public decimal smokePenalty { get; set; }
        public double idealRadius { get; set; }
        public double minRadius { get; set; }
        public double idealDistance { get; set; }
        public double radiusOnZero { get; set; }
        public double radiusOnDelim { get; set; }
        public double radiusOnMax { get; set; }
        public double delim { get; set; }
        public Typeinfo typeinfo { get; set; }

        public static explicit operator Gun(MainBatteryGun gun)
        {
            return new Gun
            {
                AmmoList = gun.ammoList.ToList(),
                BarrelDiameter = gun.barrelDiameter,
                HorizontalSector = gun.horizSector,
                HorizontalDeadZones = gun.deadZone,
                Id = gun.id,
                Index = gun.index,
                Name = gun.name,
                NumBarrels = gun.numBarrels,
                HorizontalPosition = gun.position[1],
                VerticalPosition = gun.position[0],
                HorizontalRotationSpeed = gun.rotationSpeed[0],
                VerticalRotationSpeed = gun.rotationSpeed[1],
                Reload = gun.shotDelay,
                SmokeDetectionWhenFiring = gun.smokePenalty,
            };
        }
    }
    #endregion

    #region Fire Control
    public class WgFireControl : ModuleArmaments
    {
        public decimal maxDistCoef { get; set; }
        public decimal sigmaCountCoef { get; set; }
    }
    #endregion

    #region Torpedos
    public class WgTorpedoArray : ModuleArmaments
    {
        public Dictionary<string, WgTorpedoLauncher> torpedoArray { get; set; }
    }

    public class WgTorpedoLauncher
    {
        public string[] ammoList { get; set; }
        public decimal barrelDiameter { get; set; }
        public decimal[][] deadZone { get; set; }
        public decimal[] horizSector { get; set; }
        public long id { get; set; }
        public string index { get; set; }
        public string name { get; set; }
        public int numBarrels { get; set; }
        public decimal[] rotationSpeed { get; set; }
        public decimal shotDelay { get; set; }
        public decimal[] torpedoAngles { get; set; } //unknonw meaning, needed?
        public Typeinfo typeinfo { get; set; }

        public static implicit operator TorpedoLauncher(WgTorpedoLauncher thisLauncher)
        {
            return new TorpedoLauncher
            {
                AmmoList = thisLauncher.ammoList.ToList(),
                BarrelDiameter = thisLauncher.barrelDiameter,
                HorizontalRotationSpeed = thisLauncher.rotationSpeed[0],
                VerticalRotationSpeed = thisLauncher.rotationSpeed[1],
                Id = thisLauncher.id,
                Index = thisLauncher.index,
                Name = thisLauncher.name,
                NumBarrels = thisLauncher.numBarrels,
                Reload = thisLauncher.shotDelay,
                HorizontalSector = thisLauncher.horizSector,
                HorizontalDeadZone = thisLauncher.deadZone,
                TorpedoAngles = thisLauncher.torpedoAngles,
            };
        }
    }
    #endregion

    #region AntiAir and secondaries
    //this is AA and secondaries too. smallGun i think indicates if it's a secondary
    public class ATBA : ModuleArmaments
    {
        public Dictionary<string, AntiAirAndSecondaries> antiAirAndSecondaries { get; set; }
        public decimal maxDist { get; set; }
        public decimal sigmaCount { get; set; }
        [JsonExtensionData]
        public Dictionary<string, JToken> AntiAirData { get; set; }

        [JsonIgnore]
        public Dictionary<string, AAAura> ConvertedAntiAirData
        {
            get 
            {
                if (AntiAirData == null)
                {
                    return null;
                }
                else
                {
                    return AntiAirData.Select(entry => (entry.Key, entry.Value.ToObject<AAAura>()))
                           .Where(entry => entry.Item2 != null)
                           .ToDictionary(entry => entry.Key, entry => entry.Item2);
                } 
            } 
        }
    }

    public class AntiAirAndSecondaries
    {
        public string[] ammoList { get; set; }
        public long id { get; set; }
        public string index { get; set; }
        public string name { get; set; }
        public decimal barrelDiameter { get; set; }
        public int numBarrels { get; set; }
        public decimal[] rotationSpeed { get; set; }
        public decimal shotDelay { get; set; }
        public bool smallGun { get; set; }
        public Typeinfo typeinfo { get; set; }

        public static explicit operator Gun(AntiAirAndSecondaries wgSecondary)
        {
            return new Gun
            {
                AmmoList = wgSecondary.ammoList.ToList(),
                BarrelDiameter = wgSecondary.barrelDiameter,
                Id = wgSecondary.id,
                Index = wgSecondary.index,
                NumBarrels = wgSecondary.numBarrels,
                HorizontalRotationSpeed = wgSecondary.rotationSpeed[0],
                VerticalRotationSpeed = wgSecondary.rotationSpeed[1],
                Reload = wgSecondary.shotDelay,
            };
        }
    }

    #endregion

    #region AirSupport

    /// <summary>
    /// Data for air strikes of ships.
    /// </summary>
    public class AirSupport : ModuleArmaments
    {
        public int chargesNum { get; set; }
        public decimal flyAwayTime { get; set; }
        public int maxDist { get; set; }
        public int maxPlaneFlightDist { get; set; }
        public int minDist { get; set; }
        public string planeName { get; set; }
        public decimal reloadTime { get; set; }
        public decimal timeBetweenShots { get; set; }
        public decimal timeFromHeaven { get; set; }
        
        public static implicit operator AirStrike(AirSupport thisAirSupport)
        {
            return new AirStrike
            {
                Charges = thisAirSupport.chargesNum,
                FlyAwayTime = thisAirSupport.flyAwayTime,
                MaximumDistance = thisAirSupport.maxDist,
                MaximumFlightDistance = thisAirSupport.maxPlaneFlightDist,
                MinimumDistance = thisAirSupport.minDist,
                PlaneName = thisAirSupport.planeName,
                DropTime = thisAirSupport.timeFromHeaven,
                ReloadTime = thisAirSupport.reloadTime,
                TimeBetweenShots = thisAirSupport.timeBetweenShots,
            };
        }
    }

    #endregion

    #region Air Defense
    public class AirDefense : ModuleArmaments
    {
        public bool isAA { get; set; }

        [JsonExtensionData]
        public Dictionary<string, JToken> Auras { get; set; }

        [JsonIgnore]
        public Dictionary<string, AAAura> ConvertedAuras
        {
            get => Auras?.ToDictionary(entry => entry.Key, entry => entry.Value.ToObject<AAAura>()) ?? new Dictionary<string, AAAura>();
        }
    }
    public class AAAura
    {
        public decimal areaDamage { get; set; }
        public decimal areaDamagePeriod { get; set; }
        public decimal bubbleDamage { get; set; }
        public decimal hitChance { get; set; }
        public int innerBubbleCount { get; set; }
        public decimal maxDistance { get; set; }
        public decimal minDistance { get; set; }
        public string type { get; set; }

        public static implicit operator AntiAirAura(AAAura aura)
        {
            return new AntiAirAura
            {
                ConstantDps = aura.areaDamage,
                FlakDamage = aura.bubbleDamage,
                FlakCloudsNumber = aura.innerBubbleCount,
                HitChance = aura.hitChance,
                MaxRange = aura.maxDistance,
                MinRange = aura.minDistance,
            };
        }
    }

    #endregion

    #region DepthCharges
    public class WgDepthChargesArray : ModuleArmaments
    {
        public Dictionary<string, WgDepthChargeLauncher> depthCharges { get; set; }
        public int maxPacks { get; set; }
        public decimal reloadTime { get; set; }
    }

    public class WgDepthChargeLauncher
    {
        public string[] ammoList { get; set; }
        public decimal[] horizSector { get; set; }
        public long id { get; set; }
        public string index { get; set; }
        public string name { get; set; }
        public int numBombs { get; set; }
        public decimal[] rotationSpeed { get; set; }
        public Typeinfo typeinfo { get; set; }

        public static implicit operator DepthChargeLauncher(WgDepthChargeLauncher wgLauncher)
        {
            return new DepthChargeLauncher
            {
                AmmoList = wgLauncher.ammoList.ToList(),
                DepthChargesNumber = wgLauncher.numBombs,
                HorizontalSector = wgLauncher.horizSector,
                Id = wgLauncher.id,
                Index = wgLauncher.index,
                Name = wgLauncher.name,
                RotationSpeed = wgLauncher.rotationSpeed,
            };
        }
    }
    #endregion

    #region Engine
    public class WgEngine : ModuleArmaments
    {
        public decimal backwardEngineUpTime { get; set; }
        public decimal forwardEngineUpTime { get; set; }
        public decimal speedCoef { get; set; }
    }
    #endregion

    #region Hull
    public class WgHull : ModuleArmaments
    {
        public decimal health { get; set; }
        public decimal maxSpeed { get; set; }
        public decimal rudderTime { get; set; }
        public decimal speedCoef { get; set; }
        public decimal visibilityCoefGKInSmoke { get; set; }
        public decimal visibilityFactor { get; set; }
        public decimal visibilityFactorByPlane { get; set; }
    }
    #endregion

    #region FlightControl
    public class WgFlightControl : ModuleArmaments
    {
        public string[] squadrons { get; set; }
    }

    public class WgPlane : ModuleArmaments
    {
        public string planeType { get; set; }
    }

    #endregion

    #region Sub Pinger Gun
    public class WgPingerGun : ModuleArmaments
    {
        public decimal[] rotationSpeed { get; set; }
        public WgSectorParam[] sectorParams { get; set; }
        public decimal waveDistance { get; set; }
        public int waveHitAlertTime { get; set; }
        public int waveHitLifeTime { get; set; }
        public WgWaveParam[] waveParams { get; set; }
        public decimal waveReloadTime { get; set; }

        public static implicit operator PingerGun(WgPingerGun thisWgPingerGun)
        {
            return new PingerGun
            {
                RotationSpeed = thisWgPingerGun.rotationSpeed,
                SectorParams = thisWgPingerGun.sectorParams.Select(wgSectorParam => (SectorParam)wgSectorParam).ToArray(),
                WaveDistance = thisWgPingerGun.waveDistance,
                WaveHitAlertTime = thisWgPingerGun.waveHitAlertTime,
                WaveHitLifeTime = thisWgPingerGun.waveHitLifeTime,
                WaveParams = thisWgPingerGun.waveParams.Select(wgWaveParam => (WaveParam)wgWaveParam).ToArray(),
                WaveReloadTime = thisWgPingerGun.waveReloadTime,
            };
        }
    }

    public class WgSectorParam
    {
        public decimal alertTime { get; set; }
        public decimal lifetime { get; set; }
        public decimal width { get; set; }
        public decimal[][] widthParams { get; set; }

        public static implicit operator SectorParam(WgSectorParam thisSectorParam)
        {
            return new SectorParam
            {
                AlertTime = thisSectorParam.alertTime,
                Lifetime = thisSectorParam.lifetime,
                Width = thisSectorParam.width,
                WidthParams = thisSectorParam.widthParams,
            };
        }
    }

    public class WgWaveParam
    {
        public decimal endWaveWidth { get; set; }
        public decimal energyCost { get; set; }
        public decimal startWaveWidth { get; set; }
        public decimal[] waveSpeed { get; set; }

        public static implicit operator WaveParam(WgWaveParam thisWaveParam)
        {
            return new WaveParam
            {
                EndWaveWidth = thisWaveParam.endWaveWidth,
                EnergyCost = thisWaveParam.energyCost,
                StartWaveWidth = thisWaveParam.startWaveWidth,
                WaveSpeed = thisWaveParam.waveSpeed,
            };
        }
    }

    #endregion

    #region Ship Consumable
    public class ShipAbility
    {
        public string[][] abils { get; set; }
        public int slot { get; set; }
    }
    #endregion

    #region Ship Upgrades and modules

    public class ShipUpgradeInfo
    {
        public int costCR { get; set; }
        public int costGold { get; set; }
        public int costSaleGold { get; set; }
        public int costXP { get; set; }
        public int value { get; set; }
        [JsonExtensionData]
        public Dictionary<string, JToken> Upgrades { get; set; }

        [JsonIgnore]
        public Dictionary<string, ShipUpgrade> ConvertedUpgrades
        {
            get
            {
                return Upgrades.Select(entry => (entry.Key, entry.Value.ToObject<ShipUpgrade>())).ToDictionary(entry => entry.Key, entry => entry.Item2);
            }
        }
    }
    
    public class ShipUpgrade
    {
        public bool canBuy { get; set; }
        public Dictionary<string, string[]> components { get; set; }
        public object[] nextShips { get; set; }
        public string prev { get; set; }
        public string ucType { get; set; }
    }
    #endregion

}
